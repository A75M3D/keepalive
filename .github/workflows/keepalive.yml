name: Supabase Keep Alive

on:
  schedule:
    - cron: "0 */1 * * *"   # ÙƒÙ„ 12 Ø³Ø§Ø¹Ø© (ØµØ­Ø­Øª Ø§Ù„ØªÙˆÙ‚ÙŠØª)
  workflow_dispatch:

jobs:
  ping:
    runs-on: ubuntu-latest

    steps:
      - name: Ping Supabase Projects
        env:
          SUPABASE_ANON_KEY_1: ${{ secrets.SUPABASE_ANON_KEY }}
          SUPABASE_ANON_KEY_2: ${{ secrets.SUPABASE_ANON_KEY_1 }}
        run: |
          set -euo pipefail

          # Ù…ØµÙÙˆÙØ© Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ Ù…Ø¹ Ø§Ù„Ù…ÙØ§ØªÙŠØ­ Ø§Ù„Ø®Ø§ØµØ© Ø¨ÙƒÙ„ ÙˆØ§Ø­Ø¯
          projects=(
            "https://sjtpwstkvvrautexigut.supabase.co|$SUPABASE_ANON_KEY"
            "https://nvuabiwizzeizkizhiss.supabase.co|$SUPABASE_ANON_KEY_1"
          )

          for project in "${projects[@]}"
          do
            # ÙØµÙ„ Ø§Ù„Ø±Ø§Ø¨Ø· Ø¹Ù† Ø§Ù„Ù…ÙØªØ§Ø­
            IFS='|' read -r url key <<< "$project"
            echo "ğŸ”„ Ø¬Ø§Ø±ÙŠ ping Ù„Ù„Ø±Ø§Ø¨Ø·: $url"
            
            # Ø§Ø³ØªØ®Ø¯Ø§Ù… curl Ù…Ø¹ ØªØ­ÙƒÙ… Ø£ÙØ¶Ù„ ÙÙŠ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡
            response_code=$(curl -s -o /dev/null -w "%{http_code}" \
              -H "apikey: $key" \
              -H "Authorization: Bearer $key" \
              -H "Content-Type: application/json" \
              "$url" || echo "CURL_FAILED")
            
            if [ "$response_code" == "200" ] || [ "$response_code" == "301" ] || [ "$response_code" == "302" ]; then
              echo "âœ… Ø§Ù„Ù†Ø¬Ø§Ø­: $url - ÙƒÙˆØ¯ Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø©: $response_code"
            else
              echo "âŒ ÙØ´Ù„: $url - ÙƒÙˆØ¯ Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø©: $response_code"
              # Ù„Ø§ Ù†ÙˆÙ‚Ù Ø§Ù„Ø¹Ù…Ù„ÙŠØ© ÙƒÙ„ÙŠØ§Ù‹ Ø¹Ù†Ø¯ ÙØ´Ù„ Ø£Ø­Ø¯ Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹
            fi
            echo "---"
          done
