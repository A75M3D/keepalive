name: Supabase Keep Alive

on:
  schedule:
    - cron: "0 */1 * * *"
  workflow_dispatch:

jobs:
  ping:
    runs-on: ubuntu-latest
    steps:
      - name: Ping Supabase Projects
        env:
          SUPABASE_ANON_KEY: ${{ secrets.SUPABASE_ANON_KEY }}
          SUPABASE_ANON_KEY_1: ${{ secrets.SUPABASE_ANON_KEY_1 }}
        run: |
          projects=(
            "https://sjtpwstkvvrautexigut.supabase.co|$SUPABASE_ANON_KEY|users_profiles"
            "https://nvuabiwizzeizkizhiss.supabase.co|$SUPABASE_ANON_KEY_1|products"
          )

          for project in "${projects[@]}"
          do
            IFS='|' read -r url key table <<< "$project"
            echo "ðŸ”„ Ø¬Ø§Ø±ÙŠ ping: $url - Ø§Ù„Ø¬Ø¯ÙˆÙ„: $table"
            
            response_code=$(curl -s -o /dev/null -w "%{http_code}" \
              -H "apikey: $key" \
              -H "Authorization: Bearer $key" \
              "$url/rest/v1/${table}?select=id&limit=1" || echo "FAILED")
            
            if [ "$response_code" == "200" ]; then
              echo "âœ… Ù†Ø¬Ø§Ø­: $url"
            else
              echo "âŒ ÙØ´Ù„: $url - ÙƒÙˆØ¯: $response_code"
            fi
            echo "---"
          done
